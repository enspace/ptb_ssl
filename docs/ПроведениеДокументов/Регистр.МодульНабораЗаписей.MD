# Модуль набора записей регистра

[Текст примера модуля набора записей (bsl)][0]

---

## ВыполнитьКонтрольРезультатовПроведения

Данный метод вызывается при подготовке данных для контроля остатков. Цель выполнения метода, определить строки, по которым в результате проведения образуются отрицательные остатки.

Для этого необходимо выполнить запрос для получения остатков, без указания даты среза остатков. В случае, если запрос по оборотному регистру, то без учета начала и окончания периода оборотов, с указанием периодичности = ПЕРИОД.

Для эффективного выполнения запроса, можно использовать отбор по измерениям таблицы **[ИмяРегистра]Изменение**. В данной таблице будут собраны все данные регистра, которые были изменены после записи новых движений. Изменения вычисляются путем снятия движений до записи и после записи регистра. В изменения не попадают строки, по которым не было изменений, а также строки, для которых заданные правила проверки (см. ПриЗаписи).

## ПередЗаписью

Выполняется чтение движений по регистру до записи новых данных. Чтение не производится по регистрам, не указанных в списке для контроля (см. [ПроведениеСерверПТБ.ДобавитьРегистрДляКонтроля][1])

## ПриЗаписи

В данном методе необходимо задать правила проверки изменений. Правила проверки задаются в виде массива правил, которые будут переданы в запрос сравнения движений "до" и "после". Строка массива - это выражение текста запроса (секция ИМЕЮЩИЕ). Например: `СУММА(ТаблицаДвижений.Количество) < 0`. Синоним таблицы результатов сравнения - `ТаблицаДвижений`. Для проверки доступны все ресурсы регистра.

Пример условий:

- необходимо контролировать все записи, для которых "Количество" в результате изменений уменьшилось.
  - Правило 1: `СУММА(ТаблицаДвижений.Количество) < 0`

- необходимо контролировать все записи, для которых "КоличествоПлан" уменьшается или "КоличествоФакт" увеличивается.
  - Правило 1: `СУММА(ТаблицаДвижений.КоличествоПлан) < 0`
  - Правило 2: `СУММА(ТаблицаДвижений.КоличествоФакт) > 0`

[0]: ./Регистр.МодульНабораЗаписей.bsl
[1]: ./ПроведениеСерверПТБ.MD#добавитьрегистрдляконтроля